# 數據緩存系統演示指南

## 🎯 系統概述

我們實現了一個每日數據緩存系統，大幅提升了應用性能：

### 核心特性
- **每日刷新**: 每天刷新一次所有股票數據
- **緩存優先**: 優先使用 Convex 數據庫中的緩存數據
- **智能回退**: 緩存失敗時自動使用實時 API
- **管理界面**: 完整的數據刷新管理和監控

## 🚀 使用步驟

### 1. 首次設置
```bash
# 確保開發服務器運行
npm run dev

# 訪問管理頁面
http://localhost:3000/admin
```

### 2. 手動觸發數據刷新
1. 訪問 http://localhost:3000/admin
2. 點擊 "立即刷新數據" 按鈕
3. 等待 2-5 分鐘完成刷新
4. 查看刷新狀態和結果

### 3. 體驗性能提升
刷新完成後：
1. 訪問儀表板 http://localhost:3000/dashboard
2. 觀察股票數據載入速度 (明顯更快)
3. 測試股票發現功能 (數據來自緩存)
4. 使用股票比較功能 (歷史數據來自緩存)

## 📊 數據流程

### 緩存命中流程
```
用戶請求 → 檢查 Convex 緩存 → 返回緩存數據 ✅
```

### 緩存未命中流程
```
用戶請求 → 檢查 Convex 緩存 → 緩存為空 → 調用實時 API → 返回實時數據
```

### 每日刷新流程
```
觸發刷新 → 批量調用 Yahoo Finance API → 存儲到 Convex → 記錄刷新日誌
```

## 🎛️ 管理功能

### 刷新狀態監控
- 今日是否已刷新
- 刷新成功/失敗狀態
- 更新的股票數量
- 刷新耗時統計
- 錯誤信息記錄

### 手動操作
- 立即觸發數據刷新
- 查看刷新歷史
- 監控系統狀態

## 📈 性能對比

### 刷新前 (實時 API)
- 每次請求都調用外部 API
- 載入時間: 2-5 秒
- API 調用頻率: 高
- 可能遇到 API 限制

### 刷新後 (緩存優先)
- 優先使用本地緩存
- 載入時間: 0.1-0.5 秒
- API 調用頻率: 極低
- 穩定可靠的性能

## 🔧 技術實現

### 數據庫表結構
- `dailyStockData`: 每日股票數據快照
- `historicalPrices`: 歷史價格數據 (30天)
- `dataRefreshLog`: 刷新記錄和狀態

### API 路由
- `GET /api/refresh-daily-data`: 檢查刷新狀態
- `POST /api/refresh-daily-data`: 觸發數據刷新

### Convex 函數
- `getTodayStockData`: 獲取今日股票數據
- `getHistoricalData`: 獲取歷史數據
- `performDailyRefresh`: 執行每日刷新
- `getDiscoveryData`: 獲取發現數據 (漲跌榜等)

## 🎯 最佳實践

### 建議的使用模式
1. **每日刷新**: 建議每天刷新一次數據
2. **監控狀態**: 定期檢查刷新狀態
3. **錯誤處理**: 關注刷新失敗的錯誤信息
4. **性能監控**: 觀察數據載入速度的改善

### 自動化建議
```bash
# 可以設置定時任務每日自動刷新
# 例如：每天早上 8:00 執行
curl -X POST http://localhost:3000/api/refresh-daily-data
```

## 🚀 未來擴展

### 可能的改進
- 設置自動定時刷新
- 增加更多股票到預設列表
- 實現增量更新機制
- 添加數據分析和統計功能
- 支持自定義刷新頻率

### 監控和告警
- 刷新失敗時發送通知
- 數據質量監控
- 性能指標追蹤
- 用戶使用統計

---

**注意**: 這個緩存系統是為了提升性能和減少 API 調用而設計的臨時解決方案。未來可以根據需要集成更專業的金融數據 API。